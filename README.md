# Ticket System (Flask Demo App Idea #2)

## Project Description
This is a Flask-based Issue/Support Ticket Management System designed to demonstrate end-to-end backend thinking with clear role separation (User/Admin). It's a mini Zendesk/Freshdesk application that allows users to raise and track support tickets, while administrators can manage these tickets, update their status, and approve new user registrations.

## Core Features (MVP)

### üîê Authentication & Authorization
*   **Login / Register:** Users can create accounts and log in.
*   **OTP Verification during Registration:** New users must verify their email with a One-Time Password (OTP) during registration.
*   **Admin Approval for New Users:** After email verification, new user accounts require approval from an administrator before they can log in.
*   **Forgot Password:** Users can reset their password via email.
*   **Role-based Access:** Differentiates between 'user' and 'admin' roles, restricting certain functionalities to administrators.

### üé´ Ticket Management
*   **Create Ticket:** Users can submit new support tickets with a title, description, category, and priority.
*   **Track Ticket Status:** Users can view the status of their submitted tickets.
*   **Update Ticket Status/Priority (Admin):** Administrators can update the status (Open, In Progress, Resolved) and priority (Low, Medium, High) of any ticket.

### üí¨ Communication
*   **Admin Replies:** Administrators can post replies to tickets.
*   **User Follow-up Messages:** Users can add follow-up messages to their tickets.

### üìä Dashboards
*   **User Dashboard:** Displays a user's submitted tickets along with a summary of their total, open, and resolved tickets.
*   **Admin Dashboard:** Provides an overview of all tickets in the system, including total, open, resolved, and high-priority ticket counts.

## Tech Stack
*   **Flask:** Web framework.
*   **SQLAlchemy:** ORM for database interactions.
*   **SQLite:** Database used for development.
*   **Jinja2:** Templating engine.
*   **Bootstrap:** Frontend framework for responsive UI.
*   **Flask-Login:** User session management.
*   **Flask-Mail:** For sending emails (e.g., OTP, password reset links).
*   **ItsDangerous:** For secure token generation (e.g., password reset tokens).
*   **Faker:** For generating test data.

## Setup Instructions

### 1. Clone the repository
```bash
git clone https://github.com/ishant721/Ticket-Syatem.git
cd Ticket-Syatem
```

### 2. Create and activate a virtual environment
```bash
python -m venv venv
# On Windows:
# venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate
```

### 3. Install dependencies
```bash
pip install -r ticket_system/requirements.txt
```

### 4. Initialize and Seed the Database
To set up the database with initial admin and user data, including sample tickets:
```bash
python ticket_system/seed.py
```
**Note:** Running `seed.py` will **delete all existing data** in the database and recreate it.

### 5. Configure Email Settings (for OTP and Password Reset)
Edit `ticket_system/app.py` and replace the placeholder values for `MAIL_USERNAME` and `MAIL_PASSWORD` with your actual email credentials. For Gmail, you might need to generate an App Password:
```python
# Flask-Mail configuration - REPLACE WITH YOUR CREDENTIALS
app.config['MAIL_SERVER'] = 'smtp.gmail.com'
app.config['MAIL_PORT'] = 587
app.config['MAIL_USE_TLS'] = True
app.config['MAIL_USERNAME'] = 'your_email@gmail.com'  # Replace with your email
app.config['MAIL_PASSWORD'] = 'your_app_password'  # Replace with your app password
app.config['MAIL_DEFAULT_SENDER'] = 'your_email@gmail.com' # Replace with your email
```

### 6. Run the Application
```bash
python ticket_system/app.py
```
The application will be accessible at `http://127.0.0.1:7000/`.

## Test Credentials

### Admin User
*   **Username:** `admin`
*   **Email:** `admin@test.com`
*   **Password:** `adminpass`

### Regular Users
*   **Username:** (randomly generated by `seed.py`)
*   **Email:** (randomly generated by `seed.py`)
*   **Password:** `password` (for all seeded regular users)

To view all seeded user credentials, run:
```bash
python -c "from ticket_system.app import app; from ticket_system.models import User; with app.app_context(): users = User.query.all(); [print(f'Username: {user.username}, Email: {user.email}, Role: {user.role}') for user in users]"
```

## How to Promote a User to Admin
1.  Register a new user through the website (e.g., `newuser`).
2.  Use the command-line script to promote them:
    ```bash
    python ticket_system/manage_users.py promote newuser
    ```

## Database Schema

### Users Table
*   `id` (PK)
*   `username` (Unique)
*   `email` (Unique)
*   `password` (Hashed)
*   `role` (user/admin)
*   `created_at`
*   `is_active` (Admin approval status)
*   `email_verified` (Email verification status)
*   `otp` (Temporary storage for OTP)

### Tickets Table
*   `id` (PK)
*   `title`
*   `description`
*   `category` (Tech / HR / General)
*   `priority` (Low / Medium / High)
*   `status` (Open / In Progress / Resolved)
*   `user_id` (FK to Users)
*   `created_at`

### Ticket Replies Table
*   `id` (PK)
*   `ticket_id` (FK to Tickets)
*   `commentor_name`
*   `role`
*   `message`
*   `created_at`
